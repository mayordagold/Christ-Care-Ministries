{% extends 'base.html' %}

{% block title %}Reports - Church Tracker{% endblock %}

{% block content %}
    <form class="row g-2 mb-3" method="get" action="{{ url_for('dashboard.download_report_csv') }}">
      <div class="col-auto">
        <input type="month" name="month" class="form-control" required value="{{ request.args.get('month', '') }}">
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-csv-green">Download Monthly CSV</button>
      </div>
    </form>
  <h2>Church Reports</h2>
  <p>Welcome {{ current_user.name }} ({{ current_user.role }})</p>
  <a href="{{ url_for('dashboard.view_dashboard') }}">Back to Dashboard</a>

  <hr>
  <h3>Per-Service Financial Balance</h3>
    {% if balance_data %}
    <div class="table-responsive">
    <table class="table table-striped table-hover table-sm align-middle border shadow-sm">
      <tr>
          <th>Date</th>
          <th>Service Type</th>
          <th>Total Giving</th>
          <th>Approved Expenses</th>
          <th>Balance</th>
      </tr>
      {% for b in balance_data %}
      <tr>
          <td>{{ b.date }}</td>
          <td>{{ b.service_type }}</td>
          <td>{{ '{:,.2f}'.format(b.total_giving) }}</td>
          <td>{{ '{:,.2f}'.format(b.total_expenses) }}</td>
          <td><strong>{{ '{:,.2f}'.format(b.balance) }}</strong></td>
      </tr>
      {% endfor %}
  </table>
  </div>
  {% else %}
  <div class="empty-table">No balance data yet.</div>
  {% endif %}
  <hr>
  <h3>Attendance Summary</h3>
    {% if attendance_data %}
    <div class="table-responsive">
    <table class="table table-striped table-hover table-sm align-middle border shadow-sm">
      <tr>
          <th>Date</th>
          <th>Service Type</th>
          <th>Male</th>
          <th>Female</th>
          <th>Children</th>
          <th>Total</th>
      </tr>
      {% for a in attendance_data %}
      <tr>
          <td>{{ a[0] }}</td>
          <td>{{ a[1] }}</td>
          <td>{{ a[2] }}</td>
          <td>{{ a[3] }}</td>
          <td>{{ a[4] }}</td>
          <td>{{ a[5] }}</td>
      </tr>
      {% endfor %}
  </table>
  </div>
  {% else %}
  <div class="empty-table">No attendance data yet.</div>
  {% endif %}

  <hr>
  <h3>Giving Summary</h3>
    {% if giving_data %}
    <div class="table-responsive">
    <table class="table table-striped table-hover table-sm align-middle border shadow-sm">
      <tr>
          <th>Date</th>
          <th>Service Type</th>
          <th>Total Tithe</th>
          <th>Total Offering</th>
          <th>Total Special</th>
      </tr>
      {% for g in giving_data %}
      <tr>
          <td>{{ g[0] }}</td>
          <td>{{ g[1] }}</td>
          <td>{{ g[2] }}</td>
          <td>{{ g[3] }}</td>
          <td>{{ g[4] }}</td>
      </tr>
      {% endfor %}
  </table>
  </div>
  {% else %}
  <div class="empty-table">No giving data yet.</div>
  {% endif %}

  <hr>
  <h3>Expenses Summary (Approved)</h3>
    {% if expenses_data %}
    <div class="table-responsive">
    <table class="table table-bordered table-striped table-hover table-sm align-middle border shadow-sm">
      <thead>
        <tr>
          <th>Date</th>
          <th>Service Type</th>
          <th>Category</th>
          <th>Amount</th>
          <th>Payment Method</th>
          <th>Description</th>
          <th>Paid By</th>
          <th>Approved By</th>
        </tr>
      </thead>
      <tbody>
        {% for e in expenses_data %}
        <tr>
          <td>{{ e[0] }}</td>
          <td>{{ e[1] }}</td>
          <td>{{ e[2] }}</td>
          <td>{{ '{:,.2f}'.format(e[3]) }}</td>
          <td>{{ e[4] }}</td>
          <td>{{ e[5] }}</td>
          <td>{{ e[6] }}</td>
          <td>{{ e[7] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    </div>
    {% else %}
    <div class="empty-table">No approved expense data yet.</div>
    {% endif %}
{% endblock %}
